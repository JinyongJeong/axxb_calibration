<pre class="code">
<span class="srcline"><span class="lineno"><a href="137,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T26U3">M</span>, <span class="var type1" id="S3T36U4">Sig</span> ] = distibutionPropsMex( <span class="var type1" id="S4T1U7">X</span> ) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% Note: the Matlab bulit-in function logm() is not convertable</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% into a standalone for c/c++ code generation. Another SE3 to twist matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% logarithm is used instead. </span></span></span>
<span class="srcline"><span class="lineno"><a href="137,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% addpath('/home/roma/Dropbox/2014Summer/Robotics Research/kinematics/kinematics/screws')</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% is needed in the main file that calls this function</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T26:U4"><span class="var type1" id="S5T26U10">Xsum</span> = <span class="mxinfo " id="T26:U6">zeros(<span class="mxinfo " id="T2:U7">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,11" id="srcline11"> 11</a></span><span class="line">coder.extrinsic(<span class="string">'logm'</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="137,12" id="srcline12"> 12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T2:U8"><span class="var type1" id="S8T2U22">n</span> = <span class="mxinfo " id="T2:U10"><span class="mxinfo " id="T2:U11">size(<span class="var type1" id="S4T1U26">X</span>,2)</span>/<span class="mxinfo " id="T2:U13">4</span></span></span>; <span class="comment">% Number of matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo " id="T26:U14"><span class="var type1" id="S10T26U31">X_logm</span> = <span class="mxinfo " id="T26:U16">zeros(<span class="mxinfo " id="T2:U17">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% 1. Use X to calculate the mean of se(3) Lie algebra</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% 2. Exponentiate the mean of se(3) into Lie group SE(3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S11T2U37">j</span> = <span class="mxinfo " id="T2:U19">1</span>:<span class="var type1" id="S8T2U40">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,20" id="srcline20"> 20</a></span><span class="line">    <span class="mxinfo " id="T2:U21"><span class="var type1" id="S12T2U43">j1</span> = <span class="mxinfo " id="T2:U23"><span class="mxinfo " id="T2:U24">(<span class="mxinfo " id="T2:U25"><span class="var type1" id="S11T2U48">j</span>-<span class="mxinfo " id="T2:U27">1</span></span>)*<span class="mxinfo " id="T2:U28">4</span></span>+<span class="mxinfo " id="T2:U29">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,21" id="srcline21"> 21</a></span><span class="line">    <span class="mxinfo " id="T2:U30"><span class="var type1" id="S13T2U54">j2</span> = <span class="mxinfo " id="T2:U32"><span class="var type1" id="S11T2U56">j</span>*<span class="mxinfo " id="T2:U34">4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,22" id="srcline22"> 22</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="137,23" id="srcline23"> 23</a></span><span class="line">    <span class="mxinfo " id="T26:U35"><span class="var type1" id="S10T26U60">X_logm</span> = <span class="mxinfo " id="T26:U37"><span class="fcn" id="F181N12:B62">twistlog</span>(<span class="mxinfo " id="T1:U38"><span class="var type1" id="S4T1U64">X</span>(<span class="mxinfo " id="T76:U40">:</span>,<span class="mxinfo " id="T56:U41"><span class="var type1" id="S12T2U67">j1</span>:<span class="var type1" id="S13T2U68">j2</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,24" id="srcline24"> 24</a></span><span class="line">    <span class="mxinfo " id="T26:U44"><span class="var type1" id="S5T26U71">Xsum</span> = <span class="mxinfo " id="T26:U46"><span class="var type1" id="S5T26U73">Xsum</span> + <span class="var type1" id="S10T26U74">X_logm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,25" id="srcline25"> 25</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T26:U49"><span class="var type1" id="S2T26U77">M</span> = <span class="mxinfo " id="T26:U51">expm( <span class="mxinfo " id="T26:U52">(<span class="mxinfo " id="T2:U53"><span class="mxinfo " id="T2:U54">1</span>/<span class="var type1" id="S8T2U84">n</span></span>)*<span class="var type1" id="S5T26U85">Xsum</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T2:U57"><span class="var type1" id="S16T2U88">C_old</span> = <span class="mxinfo " id="T2:U59">inf</span></span>; <span class="mxinfo " id="T2:U60"><span class="var type1" id="S18T2U93">C</span> = <span class="mxinfo " id="T2:U62">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T2:U63"><span class="var type1" id="S19T2U97">diff</span> = <span class="mxinfo " id="T2:U65">0.05</span></span>; <span class="mxinfo " id="T2:U66"><span class="var type1" id="S20T2U101">eps</span> = <span class="mxinfo " id="T2:U68">0.001</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T31:U69"><span class="var type1" id="S21T31U105">E</span> = <span class="mxinfo " id="T31:U71">zeros(<span class="mxinfo " id="T2:U72">4</span>,<span class="mxinfo " id="T2:U73">4</span>,<span class="mxinfo " id="T2:U74">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% The six Lie algebra elements for SE(3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T26:U75"><span class="mxinfo " id="T26:U76"><span class="var type1" id="S21T31U114">E</span>(<span class="mxinfo " id="T76:U78">:</span>,<span class="mxinfo " id="T76:U79">:</span>,<span class="mxinfo " id="T2:U80">1</span>)</span> = <span class="mxinfo " id="T26:U81">[<span class="mxinfo " id="T67:U82"><span class="mxinfo " id="T2:U83">0</span> <span class="mxinfo " id="T2:U84">0</span> <span class="mxinfo " id="T2:U85">0</span> <span class="mxinfo " id="T2:U86">0</span></span>; <span class="mxinfo " id="T67:U87"><span class="mxinfo " id="T2:U88">0</span> <span class="mxinfo " id="T2:U89">0</span> <span class="mxinfo " id="T2:U90">-<span class="mxinfo " id="T2:U91">1</span></span> <span class="mxinfo " id="T2:U92">0</span></span>; <span class="mxinfo " id="T67:U93"><span class="mxinfo " id="T2:U94">0</span> <span class="mxinfo " id="T2:U95">1</span> <span class="mxinfo " id="T2:U96">0</span> <span class="mxinfo " id="T2:U97">0</span></span>; <span class="mxinfo " id="T67:U98"><span class="mxinfo " id="T2:U99">0</span> <span class="mxinfo " id="T2:U100">0</span> <span class="mxinfo " id="T2:U101">0</span> <span class="mxinfo " id="T2:U102">0</span></span>]</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="137,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T26:U103"><span class="mxinfo " id="T26:U104"><span class="var type1" id="S21T31U143">E</span>(<span class="mxinfo " id="T76:U106">:</span>,<span class="mxinfo " id="T76:U107">:</span>,<span class="mxinfo " id="T2:U108">2</span>)</span> = <span class="mxinfo " id="T26:U109">[<span class="mxinfo " id="T67:U110"><span class="mxinfo " id="T2:U111">0</span> <span class="mxinfo " id="T2:U112">0</span> <span class="mxinfo " id="T2:U113">1</span> <span class="mxinfo " id="T2:U114">0</span></span>; <span class="mxinfo " id="T67:U115"><span class="mxinfo " id="T2:U116">0</span> <span class="mxinfo " id="T2:U117">0</span> <span class="mxinfo " id="T2:U118">0</span> <span class="mxinfo " id="T2:U119">0</span></span>; <span class="mxinfo " id="T67:U120"><span class="mxinfo " id="T2:U121">-<span class="mxinfo " id="T2:U122">1</span></span> <span class="mxinfo " id="T2:U123">0</span> <span class="mxinfo " id="T2:U124">0</span> <span class="mxinfo " id="T2:U125">0</span></span>; <span class="mxinfo " id="T67:U126"><span class="mxinfo " id="T2:U127">0</span> <span class="mxinfo " id="T2:U128">0</span> <span class="mxinfo " id="T2:U129">0</span> <span class="mxinfo " id="T2:U130">0</span></span>]</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="137,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T26:U131"><span class="mxinfo " id="T26:U132"><span class="var type1" id="S21T31U172">E</span>(<span class="mxinfo " id="T76:U134">:</span>,<span class="mxinfo " id="T76:U135">:</span>,<span class="mxinfo " id="T2:U136">3</span>)</span> = <span class="mxinfo " id="T26:U137">[<span class="mxinfo " id="T67:U138"><span class="mxinfo " id="T2:U139">0</span> <span class="mxinfo " id="T2:U140">-<span class="mxinfo " id="T2:U141">1</span></span> <span class="mxinfo " id="T2:U142">0</span> <span class="mxinfo " id="T2:U143">0</span></span>; <span class="mxinfo " id="T67:U144"><span class="mxinfo " id="T2:U145">1</span> <span class="mxinfo " id="T2:U146">0</span> <span class="mxinfo " id="T2:U147">0</span> <span class="mxinfo " id="T2:U148">0</span></span>; <span class="mxinfo " id="T67:U149"><span class="mxinfo " id="T2:U150">0</span> <span class="mxinfo " id="T2:U151">0</span> <span class="mxinfo " id="T2:U152">0</span> <span class="mxinfo " id="T2:U153">0</span></span>; <span class="mxinfo " id="T67:U154"><span class="mxinfo " id="T2:U155">0</span> <span class="mxinfo " id="T2:U156">0</span> <span class="mxinfo " id="T2:U157">0</span> <span class="mxinfo " id="T2:U158">0</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T26:U159"><span class="mxinfo " id="T26:U160"><span class="var type1" id="S21T31U201">E</span>(<span class="mxinfo " id="T76:U162">:</span>,<span class="mxinfo " id="T76:U163">:</span>,<span class="mxinfo " id="T2:U164">4</span>)</span> = <span class="mxinfo " id="T26:U165">[<span class="mxinfo " id="T67:U166"><span class="mxinfo " id="T2:U167">0</span> <span class="mxinfo " id="T2:U168">0</span> <span class="mxinfo " id="T2:U169">0</span> <span class="mxinfo " id="T2:U170">1</span></span>; <span class="mxinfo " id="T67:U171"><span class="mxinfo " id="T2:U172">0</span> <span class="mxinfo " id="T2:U173">0</span> <span class="mxinfo " id="T2:U174">0</span> <span class="mxinfo " id="T2:U175">0</span></span>; <span class="mxinfo " id="T67:U176"><span class="mxinfo " id="T2:U177">0</span> <span class="mxinfo " id="T2:U178">0</span> <span class="mxinfo " id="T2:U179">0</span> <span class="mxinfo " id="T2:U180">0</span></span>; <span class="mxinfo " id="T67:U181"><span class="mxinfo " id="T2:U182">0</span> <span class="mxinfo " id="T2:U183">0</span> <span class="mxinfo " id="T2:U184">0</span> <span class="mxinfo " id="T2:U185">0</span></span>]</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="137,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T26:U186"><span class="mxinfo " id="T26:U187"><span class="var type1" id="S21T31U229">E</span>(<span class="mxinfo " id="T76:U189">:</span>,<span class="mxinfo " id="T76:U190">:</span>,<span class="mxinfo " id="T2:U191">5</span>)</span> = <span class="mxinfo " id="T26:U192">[<span class="mxinfo " id="T67:U193"><span class="mxinfo " id="T2:U194">0</span> <span class="mxinfo " id="T2:U195">0</span> <span class="mxinfo " id="T2:U196">0</span> <span class="mxinfo " id="T2:U197">0</span></span>; <span class="mxinfo " id="T67:U198"><span class="mxinfo " id="T2:U199">0</span> <span class="mxinfo " id="T2:U200">0</span> <span class="mxinfo " id="T2:U201">0</span> <span class="mxinfo " id="T2:U202">1</span></span>; <span class="mxinfo " id="T67:U203"><span class="mxinfo " id="T2:U204">0</span> <span class="mxinfo " id="T2:U205">0</span> <span class="mxinfo " id="T2:U206">0</span> <span class="mxinfo " id="T2:U207">0</span></span>; <span class="mxinfo " id="T67:U208"><span class="mxinfo " id="T2:U209">0</span> <span class="mxinfo " id="T2:U210">0</span> <span class="mxinfo " id="T2:U211">0</span> <span class="mxinfo " id="T2:U212">0</span></span>]</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="137,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T26:U213"><span class="mxinfo " id="T26:U214"><span class="var type1" id="S21T31U257">E</span>(<span class="mxinfo " id="T76:U216">:</span>,<span class="mxinfo " id="T76:U217">:</span>,<span class="mxinfo " id="T9:U218">6</span>)</span> = <span class="mxinfo " id="T26:U219">[<span class="mxinfo " id="T67:U220"><span class="mxinfo " id="T2:U221">0</span> <span class="mxinfo " id="T2:U222">0</span> <span class="mxinfo " id="T2:U223">0</span> <span class="mxinfo " id="T2:U224">0</span></span>; <span class="mxinfo " id="T67:U225"><span class="mxinfo " id="T2:U226">0</span> <span class="mxinfo " id="T2:U227">0</span> <span class="mxinfo " id="T2:U228">0</span> <span class="mxinfo " id="T2:U229">0</span></span>; <span class="mxinfo " id="T67:U230"><span class="mxinfo " id="T2:U231">0</span> <span class="mxinfo " id="T2:U232">0</span> <span class="mxinfo " id="T2:U233">0</span> <span class="mxinfo " id="T2:U234">1</span></span>; <span class="mxinfo " id="T67:U235"><span class="mxinfo " id="T2:U236">0</span> <span class="mxinfo " id="T2:U237">0</span> <span class="mxinfo " id="T2:U238">0</span> <span class="mxinfo " id="T2:U239">0</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo " id="T2:U240"><span class="var type1" id="S22T2U284">count</span> = <span class="mxinfo " id="T2:U242">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,43" id="srcline43"> 43</a></span><span class="line"><span class="keyword">while</span>( <span class="mxinfo " id="T3:U243"><span class="mxinfo " id="T2:U244">abs(<span class="mxinfo " id="T2:U245"><span class="var type1" id="S18T2U293">C</span>-<span class="var type1" id="S16T2U294">C_old</span></span>)</span> &gt; <span class="mxinfo " id="T2:U248"><span class="var type1" id="S19T2U295">diff</span></span></span> &amp;&amp; <span class="mxinfo " id="T3:U250"><span class="var type1" id="S22T2U297">count</span> &lt; <span class="mxinfo " id="T2:U252">10</span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="137,44" id="srcline44"> 44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="137,45" id="srcline45"> 45</a></span><span class="line">    <span class="mxinfo " id="T2:U253"><span class="var type1" id="S16T2U301">C_old</span> = <span class="var type1" id="S18T2U302">C</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,46" id="srcline46"> 46</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="137,47" id="srcline47"> 47</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S11T2U305">j</span> = <span class="mxinfo " id="T2:U257">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="137,48" id="srcline48"> 48</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,49" id="srcline49"> 49</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T3:U258"><span class="var type1" id="S16T2U312">C_old</span> &gt; <span class="mxinfo " id="T2:U260">20</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="137,50" id="srcline50"> 50</a></span><span class="line">            <span class="mxinfo " id="T26:U261"><span class="var type1" id="S24T26U316">M1</span> = <span class="mxinfo " id="T26:U263"><span class="var type1" id="S2T26U318">M</span>*<span class="mxinfo " id="T26:U265">expm(<span class="mxinfo " id="T26:U266"><span class="mxinfo " id="T2:U267"><span class="var type1" id="S20T2U323">eps</span>*20</span>*<span class="mxinfo " id="T26:U269"><span class="var type1" id="S21T31U326">E</span>(<span class="mxinfo " id="T76:U271">:</span>,<span class="mxinfo " id="T76:U272">:</span>,<span class="var type1" id="S11T2U329">j</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,51" id="srcline51"> 51</a></span><span class="line">            <span class="mxinfo " id="T26:U274"><span class="var type1" id="S25T26U332">M2</span> = <span class="mxinfo " id="T26:U276"><span class="var type1" id="S2T26U334">M</span>*<span class="mxinfo " id="T26:U278">expm(<span class="mxinfo " id="T26:U279"><span class="mxinfo " id="T2:U280">-<span class="var type1" id="S20T2U340">eps</span>*20</span>*<span class="mxinfo " id="T26:U282"><span class="var type1" id="S21T31U343">E</span>(<span class="mxinfo " id="T76:U284">:</span>,<span class="mxinfo " id="T76:U285">:</span>,<span class="var type1" id="S11T2U346">j</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,52" id="srcline52"> 52</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T3:U287"><span class="var type1" id="S16T2U349">C_old</span> &gt; <span class="mxinfo " id="T2:U289">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="137,53" id="srcline53"> 53</a></span><span class="line">            <span class="mxinfo " id="T26:U290"><span class="var type1" id="S24T26U353">M1</span> = <span class="mxinfo " id="T26:U292"><span class="var type1" id="S2T26U355">M</span>*<span class="mxinfo " id="T26:U294">expm(<span class="mxinfo " id="T26:U295"><span class="mxinfo " id="T2:U296"><span class="mxinfo " id="T2:U297"><span class="var type1" id="S20T2U360">eps</span></span>*<span class="var type1" id="S16T2U361">C_old</span></span>*<span class="mxinfo " id="T26:U300"><span class="var type1" id="S21T31U363">E</span>(<span class="mxinfo " id="T76:U302">:</span>,<span class="mxinfo " id="T76:U303">:</span>,<span class="var type1" id="S11T2U366">j</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,54" id="srcline54"> 54</a></span><span class="line">            <span class="mxinfo " id="T26:U305"><span class="var type1" id="S25T26U369">M2</span> = <span class="mxinfo " id="T26:U307"><span class="var type1" id="S2T26U371">M</span>*<span class="mxinfo " id="T26:U309">expm(<span class="mxinfo " id="T26:U310"><span class="mxinfo " id="T2:U311"><span class="mxinfo " id="T2:U312">-<span class="var type1" id="S20T2U377">eps</span></span>*<span class="var type1" id="S16T2U378">C_old</span></span>*<span class="mxinfo " id="T26:U315"><span class="var type1" id="S21T31U380">E</span>(<span class="mxinfo " id="T76:U317">:</span>,<span class="mxinfo " id="T76:U318">:</span>,<span class="var type1" id="S11T2U383">j</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,55" id="srcline55"> 55</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="137,56" id="srcline56"> 56</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,57" id="srcline57"> 57</a></span><span class="line">            <span class="mxinfo " id="T26:U320"><span class="var type1" id="S24T26U387">M1</span> = <span class="mxinfo " id="T26:U322"><span class="var type1" id="S2T26U389">M</span>*<span class="mxinfo " id="T26:U324">expm(<span class="mxinfo " id="T26:U325"><span class="mxinfo " id="T2:U326"><span class="var type1" id="S20T2U393">eps</span></span>*<span class="mxinfo " id="T26:U328"><span class="var type1" id="S21T31U395">E</span>(<span class="mxinfo " id="T76:U330">:</span>,<span class="mxinfo " id="T76:U331">:</span>,<span class="var type1" id="S11T2U398">j</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,58" id="srcline58"> 58</a></span><span class="line">            <span class="mxinfo " id="T26:U333"><span class="var type1" id="S25T26U401">M2</span> = <span class="mxinfo " id="T26:U335"><span class="var type1" id="S2T26U403">M</span>*<span class="mxinfo " id="T26:U337">expm(<span class="mxinfo " id="T26:U338"><span class="mxinfo " id="T2:U339">-<span class="var type1" id="S20T2U408">eps</span></span>*<span class="mxinfo " id="T26:U341"><span class="var type1" id="S21T31U410">E</span>(<span class="mxinfo " id="T76:U343">:</span>,<span class="mxinfo " id="T76:U344">:</span>,<span class="var type1" id="S11T2U413">j</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,59" id="srcline59"> 59</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="137,60" id="srcline60"> 60</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,61" id="srcline61"> 61</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,62" id="srcline62"> 62</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,63" id="srcline63"> 63</a></span><span class="line">        <span class="mxinfo " id="T26:U346"><span class="var type1" id="S26T26U416">M1sum</span> = <span class="mxinfo " id="T26:U348">zeros(<span class="mxinfo " id="T2:U349">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo " id="T26:U350"><span class="var type1" id="S27T26U422">M2sum</span> = <span class="mxinfo " id="T26:U352">zeros(<span class="mxinfo " id="T2:U353">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,65" id="srcline65"> 65</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,66" id="srcline66"> 66</a></span><span class="line">        <span class="mxinfo " id="T26:U354"><span class="var type1" id="S28T26U428">M1X_logm</span> = <span class="mxinfo " id="T26:U356">zeros(<span class="mxinfo " id="T2:U357">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,67" id="srcline67"> 67</a></span><span class="line">        <span class="mxinfo " id="T26:U358"><span class="var type1" id="S29T26U434">M2X_logm</span> = <span class="mxinfo " id="T26:U360">zeros(<span class="mxinfo " id="T2:U361">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,68" id="srcline68"> 68</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,69" id="srcline69"> 69</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S30T2U440">k</span> = <span class="mxinfo " id="T2:U363">1</span>:<span class="mxinfo " id="T2:U364"><span class="mxinfo " id="T2:U365">size(<span class="var type1" id="S4T1U446">X</span>,2)</span>/<span class="mxinfo " id="T2:U367">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="137,70" id="srcline70"> 70</a></span><span class="line">            <span class="mxinfo " id="T2:U368"><span class="var type1" id="S31T2U451">k1</span> = <span class="mxinfo " id="T2:U370"><span class="mxinfo " id="T2:U371">(<span class="mxinfo " id="T2:U372"><span class="var type1" id="S30T2U456">k</span>-<span class="mxinfo " id="T2:U374">1</span></span>)*<span class="mxinfo " id="T2:U375">4</span></span>+<span class="mxinfo " id="T2:U376">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,71" id="srcline71"> 71</a></span><span class="line">            <span class="mxinfo " id="T2:U377"><span class="var type1" id="S32T2U462">k2</span> = <span class="mxinfo " id="T2:U379"><span class="var type1" id="S30T2U464">k</span>*<span class="mxinfo " id="T2:U381">4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,72" id="srcline72"> 72</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="137,73" id="srcline73"> 73</a></span><span class="line">            <span class="mxinfo " id="T26:U382"><span class="var type1" id="S28T26U468">M1X_logm</span> = <span class="mxinfo " id="T26:U384"><span class="fcn" id="F181N12:B470">twistlog</span>( <span class="mxinfo " id="T1:U385"><span class="mxinfo " id="T26:U386"><span class="var type1" id="S24T26U473">M1</span>^-1</span>*<span class="mxinfo " id="T1:U388"><span class="var type1" id="S4T1U477">X</span>(<span class="mxinfo " id="T76:U390">:</span>,<span class="mxinfo " id="T56:U391"><span class="var type1" id="S31T2U480">k1</span>:<span class="var type1" id="S32T2U481">k2</span></span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,74" id="srcline74"> 74</a></span><span class="line">            <span class="mxinfo " id="T26:U394"><span class="var type1" id="S29T26U484">M2X_logm</span> = <span class="mxinfo " id="T26:U396"><span class="fcn" id="F181N12:B486">twistlog</span>( <span class="mxinfo " id="T1:U397"><span class="mxinfo " id="T26:U398"><span class="var type1" id="S25T26U489">M2</span>^-1</span>*<span class="mxinfo " id="T1:U400"><span class="var type1" id="S4T1U493">X</span>(<span class="mxinfo " id="T76:U402">:</span>,<span class="mxinfo " id="T56:U403"><span class="var type1" id="S31T2U496">k1</span>:<span class="var type1" id="S32T2U497">k2</span></span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,75" id="srcline75"> 75</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="137,76" id="srcline76"> 76</a></span><span class="line">            <span class="mxinfo " id="T26:U406"><span class="var type1" id="S26T26U500">M1sum</span> = <span class="mxinfo " id="T26:U408"><span class="var type1" id="S26T26U502">M1sum</span> + <span class="var type1" id="S28T26U503">M1X_logm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,77" id="srcline77"> 77</a></span><span class="line">            <span class="mxinfo " id="T26:U411"><span class="var type1" id="S27T26U506">M2sum</span> = <span class="mxinfo " id="T26:U413"><span class="var type1" id="S27T26U508">M2sum</span> + <span class="var type1" id="S29T26U509">M2X_logm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,78" id="srcline78"> 78</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="137,79" id="srcline79"> 79</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,80" id="srcline80"> 80</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,81" id="srcline81"> 81</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,82" id="srcline82"> 82</a></span><span class="line">        <span class="mxinfo " id="T2:U416"><span class="var type1" id="S33T2U512">C1</span> = <span class="mxinfo " id="T2:U418"><span class="mxinfo " id="T2:U419">norm(<span class="var type1" id="S26T26U516">M1sum</span>)</span>^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,83" id="srcline83"> 83</a></span><span class="line">        <span class="mxinfo " id="T2:U421"><span class="var type1" id="S35T2U520">C2</span> = <span class="mxinfo " id="T2:U423"><span class="mxinfo " id="T2:U424">norm(<span class="var type1" id="S27T26U524">M2sum</span>)</span>^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,84" id="srcline84"> 84</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,85" id="srcline85"> 85</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T3:U426"><span class="var type1" id="S33T2U530">C1</span> &lt;= <span class="var type1" id="S35T2U531">C2</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="137,86" id="srcline86"> 86</a></span><span class="line">            <span class="mxinfo " id="T2:U429"><span class="var type1" id="S18T2U534">C</span> = <span class="var type1" id="S33T2U535">C1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,87" id="srcline87"> 87</a></span><span class="line">            <span class="mxinfo " id="T26:U432"><span class="var type1" id="S2T26U538">M</span> = <span class="var type1" id="S24T26U539">M1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,88" id="srcline88"> 88</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T2:U435"><span class="var type1" id="S18T2U543">C</span> = <span class="var type1" id="S35T2U544">C2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,90" id="srcline90"> 90</a></span><span class="line">            <span class="mxinfo " id="T26:U438"><span class="var type1" id="S2T26U547">M</span> = <span class="var type1" id="S25T26U548">M2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,92" id="srcline92"> 92</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="137,93" id="srcline93"> 93</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,94" id="srcline94"> 94</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="137,95" id="srcline95"> 95</a></span><span class="line">    <span class="mxinfo " id="T2:U441"><span class="var type1" id="S22T2U551">count</span> = <span class="mxinfo " id="T2:U443"><span class="var type1" id="S22T2U553">count</span>+<span class="mxinfo " id="T2:U445">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,96" id="srcline96"> 96</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="137,97" id="srcline97"> 97</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo " id="T36:U446"><span class="var type1" id="S3T36U557">Sig</span> = <span class="mxinfo " id="T36:U448">zeros(<span class="mxinfo " id="T2:U449">6</span>,<span class="mxinfo " id="T2:U450">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,100" id="srcline100">100</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,101" id="srcline101">101</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S36T2U564">i</span> = <span class="mxinfo " id="T2:U452">1</span>:<span class="mxinfo " id="T2:U453"><span class="mxinfo " id="T2:U454">size(<span class="var type1" id="S4T1U570">X</span>,2)</span>/<span class="mxinfo " id="T2:U456">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="137,102" id="srcline102">102</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="137,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo " id="T2:U457"><span class="var type1" id="S37T2U575">i1</span> = <span class="mxinfo " id="T2:U459"><span class="mxinfo " id="T2:U460">(<span class="mxinfo " id="T2:U461"><span class="var type1" id="S36T2U580">i</span>-<span class="mxinfo " id="T2:U463">1</span></span>)*<span class="mxinfo " id="T2:U464">4</span></span>+<span class="mxinfo " id="T2:U465">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,104" id="srcline104">104</a></span><span class="line">    <span class="mxinfo " id="T2:U466"><span class="var type1" id="S38T2U586">i2</span> = <span class="mxinfo " id="T2:U468"><span class="var type1" id="S36T2U588">i</span>*<span class="mxinfo " id="T2:U470">4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,105" id="srcline105">105</a></span><span class="line">    <span class="mxinfo " id="T36:U471"><span class="var type1" id="S3T36U592">Sig</span> = <span class="mxinfo " id="T36:U473"><span class="var type1" id="S3T36U594">Sig</span>+<span class="mxinfo " id="T36:U475"><span class="mxinfo " id="T37:U476"><span class="fcn" id="F440N8:B597">se3_vec</span>(<span class="mxinfo " id="T26:U477"><span class="fcn" id="F181N12:B599">twistlog</span>(<span class="mxinfo " id="T1:U478"><span class="mxinfo " id="T26:U479"><span class="var type1" id="S2T26U602">M</span>^(-1)</span>*<span class="mxinfo " id="T1:U481"><span class="var type1" id="S4T1U607">X</span>(<span class="mxinfo " id="T76:U483">:</span>,<span class="mxinfo " id="T56:U484"><span class="var type1" id="S37T2U610">i1</span>:<span class="var type1" id="S38T2U611">i2</span></span>)</span></span>)</span>)</span>*<span class="mxinfo " id="T38:U487"><span class="mxinfo " id="T37:U488"><span class="fcn" id="F440N8:B614">se3_vec</span>(<span class="mxinfo " id="T26:U489"><span class="fcn" id="F181N12:B616">twistlog</span>(<span class="mxinfo " id="T1:U490"><span class="mxinfo " id="T26:U491"><span class="var type1" id="S2T26U619">M</span>^(-1)</span>*<span class="mxinfo " id="T1:U493"><span class="var type1" id="S4T1U624">X</span>(<span class="mxinfo " id="T76:U495">:</span>,<span class="mxinfo " id="T56:U496"><span class="var type1" id="S37T2U627">i1</span>:<span class="var type1" id="S38T2U628">i2</span></span>)</span></span>)</span>)</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,106" id="srcline106">106</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="137,107" id="srcline107">107</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="137,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo " id="T36:U499"><span class="var type1" id="S3T36U631">Sig</span> = <span class="mxinfo " id="T36:U501"><span class="var type1" id="S3T36U633">Sig</span>*(<span class="mxinfo " id="T2:U503"><span class="mxinfo " id="T2:U504"><span class="mxinfo " id="T2:U505">1</span>/<span class="mxinfo " id="T2:U506">size(<span class="var type1" id="S4T1U640">X</span>,2)</span></span>/<span class="mxinfo " id="T2:U508">4</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="137,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="137,111" id="srcline111">111</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
